---
- name: Fetch Proxmox secrets from Vault
  community.hashi_vault.vault_kv2_get:
    url: "{{ vault_addr | default(lookup('env', 'VAULT_ADDR')) }}"
    path: "{{ vault_proxmox_path | default('proxmox') }}"
    engine_mount_point: "{{ vault_mount_point | default('ansible') }}"
    token: "{{ vault_token | default(lookup('env', 'VAULT_TOKEN')) }}"
  register: proxmox_vault_secrets
  delegate_to: localhost
  become: false

- name: Set Proxmox secrets as facts
  ansible.builtin.set_fact:
    proxmox_secrets: "{{ proxmox_vault_secrets.data.data }}"